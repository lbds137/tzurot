# Tzurot v3 Environment Configuration

# ============================================
# Discord Configuration
# ============================================
# Toggle between DEV and PRODUCTION by commenting/uncommenting the appropriate section

# --- DEVELOPMENT BOT ---
DISCORD_TOKEN=your_dev_bot_token_here
DISCORD_CLIENT_ID=your_dev_client_id
GUILD_ID=your_test_guild_id  # For guild-specific dev command deployment
AUTO_DEPLOY_COMMANDS=false  # Set to 'true' to auto-deploy commands on bot startup
AUTO_TRANSCRIBE_VOICE=false  # Set to 'true' to automatically transcribe voice messages as bot

# --- PRODUCTION BOT (comment out dev section above and uncomment this section) ---
# DISCORD_TOKEN=your_production_bot_token_here
# DISCORD_CLIENT_ID=your_production_client_id
# GUILD_ID=  # Leave empty for global command deployment
# AUTO_DEPLOY_COMMANDS=true  # Auto-deploy commands on startup
# AUTO_TRANSCRIBE_VOICE=true  # Auto-transcribe voice messages as bot (recommended for production)

BOT_OWNER_ID=your_discord_user_id  # Your personal Discord user ID for admin commands

# ============================================
# Service URLs (for local development)
# ============================================
API_GATEWAY_URL=http://localhost:3000
AI_WORKER_URL=http://localhost:3001

# ============================================
# Service-to-Service Authentication
# ============================================
# Shared secret for authenticating requests from bot-client to api-gateway.
# All protected endpoints (except /health and /avatars) require this header.
# For Railway: Set this as a SHARED variable so all services get the same value.
# Generate with: openssl rand -hex 32
INTERNAL_SERVICE_SECRET=your_service_secret_here

# ============================================
# Redis Configuration
# ============================================
REDIS_HOST=localhost
REDIS_PORT=6379
# REDIS_PASSWORD=  # Optional
# Or use REDIS_URL for Railway deployment:
# REDIS_URL=redis://default:password@host:port

# ============================================
# AI Provider Configuration
# ============================================

# AI provider (only openrouter is supported)
AI_PROVIDER=openrouter

# OpenRouter (for LLM completions - supports 300+ models including Claude, GPT, Gemini, etc.)
OPENROUTER_API_KEY=your_openrouter_api_key

# OpenAI (for embeddings and Whisper transcription only)
OPENAI_API_KEY=your_openai_api_key

# Model Configuration
# Note: These defaults are also defined in packages/common-types/src/modelDefaults.ts
DEFAULT_AI_MODEL=anthropic/claude-haiku-4.5  # Main generation model
WHISPER_MODEL=whisper-1  # For voice transcription
VISION_FALLBACK_MODEL=qwen/qwen3-vl-235b-a22b-instruct  # For image analysis fallback
EMBEDDING_MODEL=text-embedding-3-small  # For RAG memory

# Optional: ElevenLabs for voice synthesis
# ELEVENLABS_API_KEY=your_elevenlabs_api_key

# ============================================
# Database Configuration (PostgreSQL)
# ============================================
# For Local Development:
DATABASE_URL=postgresql://tzurot:tzurot_dev_password@localhost:5432/tzurot

# For Railway Deployment:
# Railway provides two connection URLs - use the appropriate one:
#
# 1. Private Network (recommended for services running on Railway):
#    - Faster (no proxy overhead)
#    - No network egress charges
#    - Only works within Railway infrastructure
#    DATABASE_URL=${{Postgres.DATABASE_URL}}
#
# 2. Public TCP Proxy (for external access from IDE/local machine):
#    - Access from anywhere
#    - SSL/TLS encrypted
#    - Network egress charges apply
#    DATABASE_URL=${{Postgres.DATABASE_PUBLIC_URL}}
#
# Security Note: TCP Proxy is safe for development databases
# - SSL/TLS encryption enabled by default
# - Strong password authentication required
# - Same security model as AWS RDS, GCP Cloud SQL
# See docs/deployment/RAILWAY_SHARED_VARIABLES.md for details

# For /admin db-sync endpoint (configured on Railway, NOT needed locally):
# These are set as environment variables on the api-gateway service in Railway.
# The db-sync endpoint runs on the deployed service and uses Railway's configured URLs.
# Only set these locally if you need to test the db-sync endpoint from local dev server.
# DEV_DATABASE_URL=postgresql://user:pass@dev-host:port/railway
# PROD_DATABASE_URL=postgresql://user:pass@prod-host:port/railway

# ============================================
# Worker Configuration
# ============================================
WORKER_CONCURRENCY=5
QUEUE_NAME=ai-requests

# ============================================
# Application Configuration
# ============================================
NODE_ENV=development
LOG_LEVEL=info

# Health check server
ENABLE_HEALTH_SERVER=true
PORT=3001  # ai-worker port

# ============================================
# Feature Flags
# ============================================
# Note: Memory (RAG with pgvector) is always enabled.
# Future: User-level or personality-level memory controls will be added to the database.

ENABLE_FREE_WILL=false  # LangGraph orchestrator (not yet implemented)

# ============================================
# Security - BYOK (Bring Your Own Key)
# ============================================
# Encryption key for user API keys (MUST be 64 hex characters = 32 bytes)
# Generate with: openssl rand -hex 32
# WARNING: If you lose this key, all stored user API keys become unrecoverable!
API_KEY_ENCRYPTION_KEY=your_64_hex_character_encryption_key_here

# ============================================
# Railway Deployment
# ============================================
# Railway sets these automatically:
# RAILWAY_ENVIRONMENT=development
# RAILWAY_PROJECT_ID=your-project-id
# RAILWAY_SERVICE_NAME=ai-worker|api-gateway|bot-client

# Railway automatically provides these from addons:
# REDIS_URL=redis://default:password@redis.railway.internal:6379
# DATABASE_URL=${{Postgres.DATABASE_URL}}  # Private network (recommended for services)
# DATABASE_PUBLIC_URL=${{Postgres.DATABASE_PUBLIC_URL}}  # TCP proxy (for external access)

# For service-to-service communication within Railway, use .railway.internal:
# API_GATEWAY_URL=http://api-gateway.railway.internal:3000

# ============================================
# Development Tools
# ============================================
# Enable throttling for resource-constrained devices (Steam Deck, low-RAM laptops, etc.)
# This limits pre-push hook concurrency and memory usage
# LOW_RESOURCE_MODE=1

# ============================================
# Database Tooling (pnpm ops db:*)
# ============================================
# Database tooling supports three environments:
#
# LOCAL (default):
#   Uses DATABASE_URL from this .env file
#   pnpm ops db:status
#   pnpm ops db:migrate
#   pnpm ops db:inspect
#
# RAILWAY DEV/PROD:
#   Uses Railway CLI to inject credentials automatically
#   Requires: railway login (authenticate first)
#   pnpm ops db:status --env dev
#   pnpm ops db:status --env prod
#   pnpm ops db:migrate --env dev
#   pnpm ops db:migrate --env prod --force  # Production requires --force
#
# Commands Reference:
#   db:status   - Show migration status (applied, pending, failed)
#   db:migrate  - Run pending migrations
#   db:deploy   - Non-interactive migration (for CI)
#   db:inspect  - Show tables, indexes, migrations (local only)
#   db:check-drift - Check for migration file modifications (local only)
#   db:fix-drift   - Fix checksum mismatches (local only)
#   db:safe-migrate - Create migration with drift sanitization
